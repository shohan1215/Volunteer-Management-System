{
    "sourceFile": "index.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 22,
            "patches": [
                {
                    "date": 1752852436183,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752852443860,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,9 +11,9 @@\n app.use(\n   cors({\n     origin: [\n       \"http://localhost:5173\",\n-      ,\n+      \n     ],\n     credentials: true,\n   })\n );\n"
                },
                {
                    "date": 1752852634787,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n   })\n );\n app.use(cookieParser());\n \n-const uri = `mongodb+srv://${process.env.DB_USER}:${process.env.DB_PASS}@cluster0.hqlh5.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0`;\n+const uri = `mongodb+srv://${process.env.DB_USER}:${process.env.DB_PASS}@cluster0.x0sebsg.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0`;\n \n // Create a MongoClient with a MongoClientOptions object to set the Stable API version\n const client = new MongoClient(uri, {\n   serverApi: {\n"
                },
                {
                    "date": 1752852953438,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -258,9 +258,9 @@\n           .toArray();\n         res.send(result);\n       }\n     });\n-    // //Connect the client to the server\t(optional starting in v4.7)\n+     //Connect the client to the server\t(optional starting in v4.7)\n     // await client.connect();\n     // // Send a ping to confirm a successful connection\n     // await client.db(\"admin\").command({ ping: 1 });\n     // console.log(\n"
                },
                {
                    "date": 1752852959899,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -258,10 +258,10 @@\n           .toArray();\n         res.send(result);\n       }\n     });\n-     //Connect the client to the server\t(optional starting in v4.7)\n-    // await client.connect();\n+    // //Connect the client to the server\t(optional starting in v4.7)\n+     await client.connect();\n     // // Send a ping to confirm a successful connection\n     // await client.db(\"admin\").command({ ping: 1 });\n     // console.log(\n     //   \"Pinged your deployment. You successfully connected to MongoDB!\"\n"
                },
                {
                    "date": 1752852967561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -261,9 +261,9 @@\n     });\n     // //Connect the client to the server\t(optional starting in v4.7)\n      await client.connect();\n     // // Send a ping to confirm a successful connection\n-    // await client.db(\"admin\").command({ ping: 1 });\n+     await client.db(\"admin\").command({ ping: 1 });\n     // console.log(\n     //   \"Pinged your deployment. You successfully connected to MongoDB!\"\n     // );\n   } finally {\n"
                },
                {
                    "date": 1752852974000,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -262,9 +262,9 @@\n     // //Connect the client to the server\t(optional starting in v4.7)\n      await client.connect();\n     // // Send a ping to confirm a successful connection\n      await client.db(\"admin\").command({ ping: 1 });\n-    // console.log(\n+     console.log(\n     //   \"Pinged your deployment. You successfully connected to MongoDB!\"\n     // );\n   } finally {\n     // Ensures that the client will close when you finish/error\n"
                },
                {
                    "date": 1752852979437,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -263,10 +263,10 @@\n      await client.connect();\n     // // Send a ping to confirm a successful connection\n      await client.db(\"admin\").command({ ping: 1 });\n      console.log(\n-    //   \"Pinged your deployment. You successfully connected to MongoDB!\"\n-    // );\n+       \"Pinged your deployment. You successfully connected to MongoDB!\"\n+     );\n   } finally {\n     // Ensures that the client will close when you finish/error\n     // await client.close();\n   }\n"
                },
                {
                    "date": 1753880191843,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -64,9 +64,9 @@\n \n     const volunteerOfWeekCollection = client\n       .db(\"Volunteer-Management\")\n       .collection(\"Volunteer-of-Week\");\n-\n+    \n     // Generate Jwt\n     app.post(\"/jwt\", async (req, res) => {\n       const email = req.body;\n       const token = jwt.sign(email, process.env.JWT_SECRET, {\n"
                },
                {
                    "date": 1753880208064,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,8 +65,11 @@\n     const volunteerOfWeekCollection = client\n       .db(\"Volunteer-Management\")\n       .collection(\"Volunteer-of-Week\");\n     \n+    const usersCollection = client\n+  .db(\"Volunteer-Management\")\n+  .collection(\"Users\");\n     // Generate Jwt\n     app.post(\"/jwt\", async (req, res) => {\n       const email = req.body;\n       const token = jwt.sign(email, process.env.JWT_SECRET, {\n"
                },
                {
                    "date": 1753880224100,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,10 +66,9 @@\n       .db(\"Volunteer-Management\")\n       .collection(\"Volunteer-of-Week\");\n     \n     const usersCollection = client\n-  .db(\"Volunteer-Management\")\n-  .collection(\"Users\");\n+  \n     // Generate Jwt\n     app.post(\"/jwt\", async (req, res) => {\n       const email = req.body;\n       const token = jwt.sign(email, process.env.JWT_SECRET, {\n"
                },
                {
                    "date": 1753880230885,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,9 +66,9 @@\n       .db(\"Volunteer-Management\")\n       .collection(\"Volunteer-of-Week\");\n     \n     const usersCollection = client\n-  \n+     \n     // Generate Jwt\n     app.post(\"/jwt\", async (req, res) => {\n       const email = req.body;\n       const token = jwt.sign(email, process.env.JWT_SECRET, {\n"
                },
                {
                    "date": 1753880239645,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,9 +66,10 @@\n       .db(\"Volunteer-Management\")\n       .collection(\"Volunteer-of-Week\");\n     \n     const usersCollection = client\n-     \n+      .db(\"Volunteer-Management\")\n+      .collection(\"Users\");\n     // Generate Jwt\n     app.post(\"/jwt\", async (req, res) => {\n       const email = req.body;\n       const token = jwt.sign(email, process.env.JWT_SECRET, {\n"
                },
                {
                    "date": 1753880252355,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,8 +68,9 @@\n     \n     const usersCollection = client\n       .db(\"Volunteer-Management\")\n       .collection(\"Users\");\n+      \n     // Generate Jwt\n     app.post(\"/jwt\", async (req, res) => {\n       const email = req.body;\n       const token = jwt.sign(email, process.env.JWT_SECRET, {\n"
                },
                {
                    "date": 1753880371404,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,9 +68,9 @@\n     \n     const usersCollection = client\n       .db(\"Volunteer-Management\")\n       .collection(\"Users\");\n-      \n+\n     // Generate Jwt\n     app.post(\"/jwt\", async (req, res) => {\n       const email = req.body;\n       const token = jwt.sign(email, process.env.JWT_SECRET, {\n@@ -262,8 +262,10 @@\n           .toArray();\n         res.send(result);\n       }\n     });\n+\n+    \n     // //Connect the client to the server\t(optional starting in v4.7)\n      await client.connect();\n     // // Send a ping to confirm a successful connection\n      await client.db(\"admin\").command({ ping: 1 });\n"
                },
                {
                    "date": 1753880398323,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -263,9 +263,22 @@\n         res.send(result);\n       }\n     });\n \n-    \n+    app.post(\"/users\", async (req, res) => {\n+  const user = req.body;\n+\n+  // Check if user already exists\n+  const existingUser = await usersCollection.findOne({ email: user.email });\n+\n+  if (!existingUser) {\n+    const result = await usersCollection.insertOne(user);\n+    res.send({ inserted: true, data: result });\n+  } else {\n+    res.send({ inserted: false, message: \"User already exists\" });\n+  }\n+});\n+\n     // //Connect the client to the server\t(optional starting in v4.7)\n      await client.connect();\n     // // Send a ping to confirm a successful connection\n      await client.db(\"admin\").command({ ping: 1 });\n"
                },
                {
                    "date": 1753880421597,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -264,9 +264,9 @@\n       }\n     });\n \n     app.post(\"/users\", async (req, res) => {\n-  const user = req.body;\n+   const user = req.body;\n \n   // Check if user already exists\n   const existingUser = await usersCollection.findOne({ email: user.email });\n \n"
                },
                {
                    "date": 1753880427186,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -264,9 +264,9 @@\n       }\n     });\n \n     app.post(\"/users\", async (req, res) => {\n-   const user = req.body;\n+    const user = req.body;\n \n   // Check if user already exists\n   const existingUser = await usersCollection.findOne({ email: user.email });\n \n"
                },
                {
                    "date": 1753880432817,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -264,9 +264,9 @@\n       }\n     });\n \n     app.post(\"/users\", async (req, res) => {\n-    const user = req.body;\n+      const user = req.body;\n \n   // Check if user already exists\n   const existingUser = await usersCollection.findOne({ email: user.email });\n \n"
                },
                {
                    "date": 1753880447078,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -264,9 +264,9 @@\n       }\n     });\n \n     app.post(\"/users\", async (req, res) => {\n-      const user = req.body;\n+  const user = req.body;\n \n   // Check if user already exists\n   const existingUser = await usersCollection.findOne({ email: user.email });\n \n"
                },
                {
                    "date": 1753880522590,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -247,8 +247,9 @@\n       res.send(result);\n     });\n     // Sort Functionality\n     app.get(\"/sort-by\", async (req, res) => {\n+      \n       const sortBy = req.query.sort;\n       if (sortBy === \"Number\") {\n         const result = await volunteerNeedPostCollection\n           .find()\n"
                },
                {
                    "date": 1753880538015,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -264,8 +264,9 @@\n       }\n     });\n \n     app.post(\"/users\", async (req, res) => {\n+      \n \n   // Check if user already exists\n   const existingUser = await usersCollection.findOne({ email: user.email });\n \n"
                },
                {
                    "date": 1753880626425,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -270,10 +270,10 @@\n       const existingUser = await usersCollection.findOne({ email: user.email });\n \n \n \n-  \n \n+\n     // //Connect the client to the server\t(optional starting in v4.7)\n      await client.connect();\n     // // Send a ping to confirm a successful connection\n      await client.db(\"admin\").command({ ping: 1 });\n"
                }
            ],
            "date": 1752852436183,
            "name": "Commit-0",
            "content": "const express = require(\"express\");\nconst cors = require(\"cors\");\nconst jwt = require(\"jsonwebtoken\");\nconst { MongoClient, ServerApiVersion, ObjectId } = require(\"mongodb\");\nrequire(\"dotenv\").config();\nconst port = process.env.PORT || 5000;\nconst app = express();\nconst cookieParser = require(\"cookie-parser\");\n\napp.use(express.json());\napp.use(\n  cors({\n    origin: [\n      \"http://localhost:5173\",\n      ,\n    ],\n    credentials: true,\n  })\n);\napp.use(cookieParser());\n\nconst uri = `mongodb+srv://${process.env.DB_USER}:${process.env.DB_PASS}@cluster0.hqlh5.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0`;\n\n// Create a MongoClient with a MongoClientOptions object to set the Stable API version\nconst client = new MongoClient(uri, {\n  serverApi: {\n    version: ServerApiVersion.v1,\n    strict: true,\n    deprecationErrors: true,\n  },\n});\n\n// verifyToken\nconst verifyToken = (req, res, next) => {\n  const token = req.cookies?.token;\n  if (!token)\n    return res.status(401).send({ message: \"401 Unauthorized access\" });\n  jwt.verify(token, process.env.JWT_SECRET, (err, decoded) => {\n    if (err) {\n      return res.status(401).send({ message: \"401 Unauthorized access\" });\n    }\n    req.user = decoded;\n    next();\n  });\n};\n\nasync function run() {\n  try {\n    // Data Base\n    const volunteerNeedPostCollection = client\n      .db(\"Volunteer-Management\")\n      .collection(\"Volunteer-Need-Post\");\n\n    const volunteerRequestCollection = client\n      .db(\"Volunteer-Management\")\n      .collection(\"Volunteer-Request\");\n    const eventCollection = client\n      .db(\"Volunteer-Management\")\n      .collection(\"Upcoming-Event\");\n\n    const eventRegisterCollection = client\n      .db(\"Volunteer-Management\")\n      .collection(\"Event-Register\");\n\n    const volunteerOfWeekCollection = client\n      .db(\"Volunteer-Management\")\n      .collection(\"Volunteer-of-Week\");\n\n    // Generate Jwt\n    app.post(\"/jwt\", async (req, res) => {\n      const email = req.body;\n      const token = jwt.sign(email, process.env.JWT_SECRET, {\n        expiresIn: \"365d\",\n      });\n      res\n        .cookie(\"token\", token, {\n          httpOnly: true,\n          secure: process.env.NODE_ENV === \"production\",\n          sameSite: process.env.NODE_ENV === \"production\" ? \"none\" : \"strict\",\n        })\n        .send({ success: true });\n    });\n\n    // logout || clear cookie from browser\n    app.post(\"/logout\", async (req, res) => {\n      res\n        .clearCookie(\"token\", {\n          httpOnly: true,\n          secure: process.env.NODE_ENV === \"production\",\n          sameSite: process.env.NODE_ENV === \"production\" ? \"none\" : \"strict\",\n        })\n        .send({ success: true });\n    });\n    // Get All Volunteer Post\n    app.get(\"/all-volunteer-need-post\", async (req, res) => {\n      const search = req.query.search;\n      let options = {};\n      let query = {\n        title: {\n          $regex: search,\n          $options: \"i\",\n        },\n      };\n      const result = await volunteerNeedPostCollection\n        .find(query, options)\n        .toArray();\n      res.send(result);\n    });\n    // Get a Specific Post by id\n    app.get(\"/volunteer-post/:id\", async (req, res) => {\n      const id = req.params.id;\n      const query = { _id: new ObjectId(id) };\n      const result = await volunteerNeedPostCollection.findOne(query);\n      res.send(result);\n    });\n\n    //  Get a specifix post by Email\n    app.get(\"/my-post\", verifyToken, async (req, res) => {\n      const email = req.query.email;\n      if (req.user?.email !== req.query.email) {\n        return res.status(403).send({\n          message: \"403 : Access to the requested resource is forbidden\",\n        });\n      }\n      const query = { \"organizer.email\": email };\n      const result = await volunteerNeedPostCollection.find(query).toArray();\n      res.send(result);\n    });\n\n    // Get a Specifix request By Email\n    app.get(\"/my-request\", verifyToken, async (req, res) => {\n      const email = req.query.email;\n      if (req.user?.email !== req.query.email) {\n        return res.status(403).send({\n          message: \"403 : Access to the requested resource is forbidden\",\n        });\n      }\n      const query = { \"volunteer.volunteerEmail\": email };\n      const result = await volunteerRequestCollection.find(query).toArray();\n      res.send(result);\n    });\n    // Volunteer Need Post\n    app.post(\"/volunteer-need-post\", verifyToken, async (req, res) => {\n      const volunteerNeedPost = req.body;\n      const result = await volunteerNeedPostCollection.insertOne(\n        volunteerNeedPost\n      );\n      res.send(result);\n    });\n\n    // Be a Volunter Request\n    app.post(\"/volunteer-request\", verifyToken, async (req, res) => {\n      const volunteerReq = req.body;\n      const result = await volunteerRequestCollection.insertOne(volunteerReq);\n\n      //1. Decrease the volunteer Need count\n      const filter = { _id: new ObjectId(volunteerReq.postId) };\n      const update = {\n        $inc: { numberOfVolunteer: -1 },\n      };\n      const updateCount = await volunteerNeedPostCollection.updateOne(\n        filter,\n        update\n      );\n      res.send(result);\n    });\n    // Volunteer Nees Now Section\n    app.get(\"/volunteer-need-now\", async (req, res) => {\n      const result = await volunteerNeedPostCollection\n        .find()\n        .sort({ deadline: 1 })\n        .limit(4)\n        .toArray();\n\n      res.send(result);\n    });\n\n    // Update Need Volunteer By Id\n    app.put(\"/update-post/:id\", verifyToken, async (req, res) => {\n      const id = req.params.id;\n      const updatePost = req.body;\n      const updated = {\n        $set: updatePost,\n      };\n      const query = { _id: new ObjectId(id) };\n      const options = { upsert: true };\n      const result = await volunteerNeedPostCollection.updateOne(\n        query,\n        updated,\n        options\n      );\n      res.send(result);\n    });\n\n    // Delete My Post\n    app.delete(\"/delete-post/:id\", verifyToken, async (req, res) => {\n      const id = req.params.id;\n      const query = { _id: new ObjectId(id) };\n      const result = await volunteerNeedPostCollection.deleteOne(query);\n      res.send(result);\n    });\n    // Cancle My Request\n    app.delete(\"/cancle-request/:id\", verifyToken, async (req, res) => {\n      const id = req.params.id;\n      const query = { _id: new ObjectId(id) };\n      const result1 = await volunteerRequestCollection.findOne(query);\n      const result = await volunteerRequestCollection.deleteOne(query);\n\n      //1. Increase the volunteer Need count\n      const filter = { _id: new ObjectId(result1.postId) };\n      const update = {\n        $inc: { numberOfVolunteer: 1 },\n      };\n      const updateCount = await volunteerNeedPostCollection.updateOne(\n        filter,\n        update\n      );\n      res.send(result);\n    });\n    // Upcoming Event\n    app.get(\"/upcoming-event\", async (req, res) => {\n      const result = await eventCollection.find().toArray();\n      res.send(result);\n    });\n    // Register\n    app.post(\"/event-registration\", async (req, res) => {\n      const register = req.body;\n      const filter = {\n        eventId: register.eventId,\n        email: register.email,\n      };\n      const result1 = await eventRegisterCollection.findOne(filter);\n      if (result1) {\n        res.send(\"Already Registered\");\n      } else {\n        const result = await eventRegisterCollection.insertOne(register);\n        res.send(result);\n      }\n    });\n    // Volunteer Of the Week\n    app.get(\"/volunteer-of-week\", async (req, res) => {\n      const result = await volunteerOfWeekCollection.find().toArray();\n      res.send(result);\n    });\n    // Sort Functionality\n    app.get(\"/sort-by\", async (req, res) => {\n      const sortBy = req.query.sort;\n      if (sortBy === \"Number\") {\n        const result = await volunteerNeedPostCollection\n          .find()\n          .sort({ numberOfVolunteer: -1 })\n          .toArray();\n        res.send(result);\n      } else if (sortBy === \"Deadline\") {\n        const result = await volunteerNeedPostCollection\n          .find()\n          .sort({ deadline: 1 })\n          .toArray();\n        res.send(result);\n      }\n    });\n    // //Connect the client to the server\t(optional starting in v4.7)\n    // await client.connect();\n    // // Send a ping to confirm a successful connection\n    // await client.db(\"admin\").command({ ping: 1 });\n    // console.log(\n    //   \"Pinged your deployment. You successfully connected to MongoDB!\"\n    // );\n  } finally {\n    // Ensures that the client will close when you finish/error\n    // await client.close();\n  }\n}\nrun().catch(console.dir);\n\napp.get(\"/\", (req, res) => {\n  res.send(\"Server is Running\");\n});\n\napp.listen(port, () => {\n  console.log(`Server is running on port ${port}`);\n});\n"
        }
    ]
}